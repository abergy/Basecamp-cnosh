<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>cNosh</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" type="text/css" media="screen" href="main.css" />
  <script src="main.js"></script>

  <script>
    var jsonData = JSON.parse(
      '{"cats": {"c1_name": "Balu","c1_uid": 0,"c1_lastfeedingtime": "2019-01-18T16:00:13Z","c1_extra_amount_size": 1,"c1_extra_amount_number": 3,"c1_extra_amount_count": 0,"c1_extra_delay": 60,"c1_created": "1","c2_name": "Lisa","c2_uid": "654321","c2_lastfeedingtime": "2019-01-18T16:00:13Z","c2_extra_amount_size": 2,"c2_extra_amount_number": 2,"c2_extra_amount_count": 0,"c2_extra_delay": 30,"c2_created": "1","c3_name": "","c3_uid": 0,"c3_lastfeedingtime": "","c3_extra_amount_size": 0,"c3_extra_amount_number": 0,"c3_extra_amount_count": 0,"c3_extra_delay": 0,"c3_created": "0"},"feedingtimes": {"time_1_h": 9,"time_1_m": 15,"time_2_h": 13,"time_2_m": 0,"time_3_h": 19,"time_3_m": 30,"time_4_h": 22,"time_4_m": 0,"time_amount_size": 2},"statistics": {"startdate": "2019-01-18T16:00:13Z","last_savedate": "2019-01-18T16:00:13Z","lastfeedingtime": "2019-01-18T16:00:13Z","total_amount_time": 150,"total_amount_extra": 80,"cnosh_configuration": 0}}'
    );

    // jsonData = 'cats.json';

    function load() {
      console.log('CNosh JSON loaded');
      var request = new XMLHttpRequest();

      function transferComplete() {
        var data = JSON.parse(this.responseText);
        build_profiles(data);
      };

      function transferFailed(evt) {
        console.log(
          'Looks like there was a problem. Status Code: ' + request.status);
        addElementToDom(
          'h1', 'error', 'Could not load configuration: ' + request.status, {
            'style': 'color:red'
          });
        return;
      };
      request.addEventListener('load', transferComplete);
      request.addEventListener('error', transferFailed);
      request.open('GET', jsonData);
      request.send();
    };

    function build_profiles(data) {
      console.log("build_profiles entered");
      let limiter = document.getElementById("limiter");

      let container_table100 = document.createElement('div');
      container_table100.setAttribute('class', 'container-table100');

      let wrap_table100 = document.createElement('div');
      wrap_table100.setAttribute('class', 'wrap-table100');

      let table100 = document.createElement('div');
      table100.setAttribute('class', 'table100');

      let table = document.createElement('table');
      let thead = document.createElement('thead');

      let tr = document.createElement('tr');
      tr.setAttribute('class', 'table100-head');

      let th1 = document.createElement('th');
      th1.innerHTML = 'Name';
      th1.setAttribute('class', 'column1');

      let th2 = document.createElement('th');
      th2.innerHTML = 'RFID';
      th2.setAttribute('class', 'column2');

      let th3 = document.createElement('th');
      th3.innerHTML = "Futtermenge";
      th3.setAttribute('class', 'column3');

      let th4 = document.createElement('th');
      th4.setAttribute('class', 'column4');

      let tbody = document.createElement('tbody');

      tr.appendChild(th1);
      tr.appendChild(th2);
      tr.appendChild(th3);
      tr.appendChild(th4);
      thead.appendChild(tr);

      var new_profile = document.getElementById('new_profile');

      let profile_count = 0;

      for (let i = 0; i < 3; i++) {
        if (data.cats['c' + (i + 1) + '_created'] === "1") {

          profile_count++;

          if (profile_count > 3) {
            //new_profile.style.display = "none";
            new_profile.setAttribute('class', 'button new_profile');
            new_profile.innerHTML = "Maximale Anzahl erreicht";
          }

          let tr = document.createElement('tr');

          let td_column1 = document.createElement('td');
          td_column1.setAttribute('class', 'column1');
          td_column1.innerHTML = data.cats['c' + (i + 1) + '_name'];

          let td_column2 = document.createElement('td');
          td_column2.setAttribute('class', 'column2');

          let a_column2 = document.createElement('a');
          a_column2.setAttribute('href', 'profiles_cat_rfid.htm?' + 'c' + (i + 1) + '_uid' + '=' + data.cats['c' + (i +
            1) + '_uid']);
          a_column2.innerHTML = 'konfigurieren';

          let td_column3 = document.createElement('td');
          td_column3.setAttribute('class', 'column4');

          let a_column3 = document.createElement('a');
          a_column3.setAttribute('href', 'profiles_cat_amount.htm?' + 'c' + (i + 1) + '_uid' + '=' + data.cats['c' + (i +
            1) + '_uid'] + '?c' + (i + 1) + '_extra_amount_number' + '=' + data.cats['c' + (i + 1) +
            '_extra_amount_number'] + '?c' + (i + 1) + '_extra_amount_size' + '=' + data.cats['c' + (i + 1) +
            '_extra_amount_size'] + '?c' + (i + 1) + '_extra_delay' + '=' + data.cats['c' + (i + 1) +
            '_extra_delay']);
          a_column3.innerHTML = 'konfigurieren';

          let td_column4 = document.createElement('td');
          td_column4.setAttribute('class', 'column4');

          let a_column4 = document.createElement('a');
          a_column4.setAttribute('href', '#popup1');
          let popup_delete = 'popup(\'c' + (i + 1) + '_uid\', \'' + data.cats['c' + (i + 1) + '_name'] + '\')';
          a_column4.setAttribute('onclick', popup_delete);

          a_column4.innerHTML = 'löschen';

          td_column2.appendChild(a_column2);
          td_column3.appendChild(a_column3);
          td_column4.appendChild(a_column4);

          tr.appendChild(td_column1);
          tr.appendChild(td_column2);
          tr.appendChild(td_column3);
          tr.appendChild(td_column4);

          tbody.appendChild(tr);
        }

        if (data.cats['c' + (i + 1) + '_created'] === "0") {
          new_profile.setAttribute('href', 'profiles_add.htm?c' + (i + 1) + '_name=' + data.cats['c' + (i + 1) + '_name']);
        }
      }

      table.appendChild(thead);
      table.appendChild(tbody);
      table100.appendChild(table);
      wrap_table100.appendChild(table100);
      container_table100.appendChild(wrap_table100);
      limiter.appendChild(container_table100);
    }

    window.onload = function () {
      //load();
      build_profiles(jsonData);
    }

    function popup(key, name) {
      var button = document.getElementById('delete_button');
      button.setAttribute('onclick', 'delete_cat(\'' + key + '\')');
      var head = document.getElementById('head');
      head.innerHTML = 'Soll ' + name + ' wirklich gelöscht werden?';
    }
  </script>
</head>

<body>
  <div class="container">
    <nav>
      <img src="logo.png" alt="" class="logo">
      <div id="level">Füllstand: 90%</div>
      <div class="menu">
        <a href="index.htm">Netzwerk</a>
        <a href="profiles.htm" class="active">Profile</a>
        <a href="feeding_times.htm">Fütterzeiten</a>
        <a href="statistics.htm">Statistik</a>
        <a href="configuration.htm">Konfiguration</a>
      </div>
    </nav>

    <main>
      <h1>Profile</h1>
      <div class="info">
        <span>Info: </span>Hier kannst du Profile für deine Katzen anlegen oder bestehende bearbeiten.</br>
        Es können maximal 5 Katzen angelegt werden.
      </div>

      <div class="limiter" id="limiter"></div>

      <a href="profiles_add.htm" class="button" id="new_profile">Profil anlegen</a>

      <div id="popup1" class="overlay">
        <div class="popup">
          <h2 id="head">Katze löschen</h2>
          <a class="close" href="#">&times;</a>
          <div class="content">
            Das Profil wird damit unwiderruflich gelöscht.
            <a class="button right" href="#">Nein</a>
            <button id="delete_button" class="button right">Ja</button>
          </div>
        </div>
      </div>

    </main>
  </div>
</body>

</html>