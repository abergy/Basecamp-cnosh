<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>cNosh</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" media="screen" href="main.css" />
    <script src="main.js"></script>

    <script>
        jsonData = 'cats.json';

            function load() {
                console.log('CNosh JSON loaded');
                var request = new XMLHttpRequest();

                function transferComplete() {
                    var data = JSON.parse(this.responseText);
                    build_cat_amount(data);
                };

                function transferFailed(evt) {
                    console.log(
                        'Looks like there was a problem. Status Code: ' + request.status);
                    addElementToDom(
                        'h1', 'error', 'Could not load configuration: ' + request.status, {
                            'style': 'color:red'
                        });
                    return;
                };
                request.addEventListener('load', transferComplete);
                request.addEventListener('error', transferFailed);
                request.open('GET', jsonData);
                request.send();
            };
        
        /* id: element id
           maxValue: maximale allow input value
           steps: step size per click */
        function increaseValue(id, maxValue, steps) {
            var value = parseInt(document.getElementById(id).value, 10);
            if (value >= maxValue) {
                value = maxValue;
            } else {
                value = isNaN(value) ? 0 : value;
                value = value + steps;
            }
            document.getElementById(id).value = value;
        }

        /* id: element id
           minValue: minimal allow input value
           steps: step size per click */
        function decreaseValue(id, minValue, steps) {
            var value = parseInt(document.getElementById(id).value, 10);
            value = isNaN(value) ? 0 : value;
            value < 1 ? value = 1 : '';
            value = value - steps;
            if (value < minValue) {
                value = minValue;
            }
            document.getElementById(id).value = value;
        }

        function build_cat_amount(data) {
            let number_extra_food = document.getElementById('number_extra_food');
            let quantity_per_portion = document.getElementById('quantity_per_portion');
            let lock_after_feeding = document.getElementById('lock_after_feeding');
            let cat_name = document.getElementById('cat_name');

            if (getQueryFirstKey() === "c1_uid") {
                number_extra_food.setAttribute('value', data.cats['c1_extra_amount_number']);
                quantity_per_portion.setAttribute('value', data.cats['c1_extra_amount_size']);
                lock_after_feeding.setAttribute('value', data.cats['c1_extra_delay']);
                number_extra_food.setAttribute('amount-config', 'c1_extra_amount_number');
                quantity_per_portion.setAttribute('amount-config', 'c1_extra_amount_size');
                lock_after_feeding.setAttribute('amount-config', 'c1_extra_delay');
            }
            if (getQueryFirstKey() === "c2_uid") {
                number_extra_food.setAttribute('value', data.cats['c2_extra_amount_number']);
                quantity_per_portion.setAttribute('value', data.cats['c2_extra_amount_size']);
                lock_after_feeding.setAttribute('value', data.cats['c2_extra_delay']);
                number_extra_food.setAttribute('amount-config', 'c2_extra_amount_number');
                quantity_per_portion.setAttribute('amount-config', 'c2_extra_amount_size');
                lock_after_feeding.setAttribute('amount-config', 'c2_extra_delay');
            }
            if (getQueryFirstKey() === "c3_uid") {
                number_extra_food.setAttribute('value', data.cats['c3_extra_amount_number']);
                quantity_per_portion.setAttribute('value', data.cats['c3_extra_amount_size']);
                lock_after_feeding.setAttribute('value', data.cats['c3_extra_delay']);
                number_extra_food.setAttribute('amount-config', 'c3_extra_amount_number');
                quantity_per_portion.setAttribute('amount-config', 'c3_extra_amount_size');
                lock_after_feeding.setAttribute('amount-config', 'c3_extra_delay');
            }
        }

        window.onload = function () {
           load();
        }
    </script>
</head>

<body>
    <div class="container">
        <nav>
            <img src="logo.png" alt="" class="logo">
            <div id="level">Füllstand: 90%</div>
            <div class="menu">
                <a href="index.htm">Netzwerk</a>
                <a href="profiles.htm" class="active">Profile</a>
                <a href="feeding_times.htm">Fütterzeiten</a>
                <a href="statistics.htm">Statistik</a>
                <a href="configuration.htm">Konfiguration</a>
            </div>
        </nav>

        <main>
            <h1>Profile</h1>

            <div class="info">
                <span>Info: </span>Anzahl und Menge Extrafutter pro Tag.
            </div>

            <ul class="breadcrumb">
                <li><a href="profiles.htm">Profile</a></li>
                <li id="cat_name">Name der Katze</li>
                <li>Futtermenge</li>
            </ul>

            <div class="form">
                <form action="#" onsubmit='collect_cat_amount()'>
                    <div class="row">
                        <div class="col-15">
                            <label for="cat_name">Anzahl Extrafutter</label>
                        </div>
                        <div class="col-85">
                            <div class="value-button" id="decrease" onclick="decreaseValue('number_extra_food', 0, 1)"
                                value="Decrease Value">-</div>
                            <input type="number" readonly="readonly" id="number_extra_food" class="number"
                                value="" />
                            <div class="value-button" id="increase" onclick="increaseValue('number_extra_food', 5, 1)"
                                value="Increase Value">+</div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-15">
                            <label for="cat_name">Menge pro Portion</label>
                        </div>
                        <div class="col-85">
                            <div class="value-button" id="decrease" onclick="decreaseValue('quantity_per_portion', 0, 1)"
                                value="Decrease Value">-</div>
                            <input type="number" readonly="readonly" id="quantity_per_portion"
                                class="number" value="" />
                            <div class="value-button" id="increase" onclick="increaseValue('quantity_per_portion', 5, 1)"
                                value="Increase Value">+</div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-15">
                            <label for="cat_name">Sperre nach Fütterung (Minuten)</label>
                        </div>
                        <div class="col-85">
                            <div class="value-button" id="decrease" onclick="decreaseValue('lock_after_feeding',30, 30)"
                                value="Decrease Value">-</div>
                            <input type="number" readonly="readonly" id="lock_after_feeding" class="number"
                                value="" />
                            <div class="value-button" id="increase" onclick="increaseValue('lock_after_feeding', 120, 30)"
                                value="Increase Value">+</div>
                        </div>
                    </div>

                    <div class="row">
                        <input type="submit" value="Speichern">
                    </div>
                </form>
            </div>

        </main>
    </div>
</body>

</html>